<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>合并图片</title>
    <url>/2020/10/03/combain-image/</url>
    <content><![CDATA[<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">width = <span class="number">0</span></span><br><span class="line">height = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> imageFile <span class="keyword">in</span> sys.argv[<span class="number">1</span>:]:</span><br><span class="line">    <span class="keyword">with</span> Image.open(imageFile) <span class="keyword">as</span> im2:</span><br><span class="line">        width = width + im2.size[<span class="number">0</span>]</span><br><span class="line">        height = max(height, im2.size[<span class="number">1</span>])</span><br><span class="line">im = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (width, height))</span><br><span class="line">width = <span class="number">0</span></span><br><span class="line">height = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> imageFile <span class="keyword">in</span> sys.argv[<span class="number">1</span>:]:</span><br><span class="line">    <span class="keyword">with</span> Image.open(imageFile) <span class="keyword">as</span> im2:</span><br><span class="line">        im2_width = im2.size[<span class="number">0</span>]</span><br><span class="line">        im2_height = im2.size[<span class="number">1</span>]</span><br><span class="line">        im.paste(im2.crop((<span class="number">0</span>, <span class="number">0</span>, im2_width, im2_height)), (width, <span class="number">0</span>, width + im2_width, im2_height))</span><br><span class="line">        width = width + im2_width</span><br><span class="line">im.save(<span class="string">&#x27;result.jpeg&#x27;</span>, <span class="string">&#x27;JPEG&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>用几何原语再现图像</title>
    <url>/2020/10/04/primitive/</url>
    <content><![CDATA[<p><img src="/assets/me_rect.jpg"><br><img src="/assets/me_cricle.jpg"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">draw_circle</span>(<span class="params">startX, startY, radius, r, g, b</span>):</span></span><br><span class="line">    pu()</span><br><span class="line">    colormode(<span class="number">255</span>)</span><br><span class="line">    pencolor(r, g, b)</span><br><span class="line">    begin_fill()</span><br><span class="line">    fillcolor((r, g, b))</span><br><span class="line">    goto(startX, startY)</span><br><span class="line">    pd()</span><br><span class="line">    </span><br><span class="line">    circle(radius)</span><br><span class="line">    </span><br><span class="line">    end_fill()</span><br><span class="line">    pu()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">line</span>(<span class="params">startX, startY, endX, endY, r, g, b</span>):</span></span><br><span class="line">    colormode(<span class="number">255</span>)</span><br><span class="line">    pencolor(r, g, b)</span><br><span class="line">    begin_fill()</span><br><span class="line">    fillcolor((r, g, b))</span><br><span class="line">    goto(startX, startY)</span><br><span class="line">    pd()</span><br><span class="line">    forward(abs(endX - startX))</span><br><span class="line">    right(<span class="number">90</span>)</span><br><span class="line">    forward(abs(endY - startY))</span><br><span class="line">    right(<span class="number">90</span>)</span><br><span class="line">    forward(abs(endX - startX))</span><br><span class="line">    right(<span class="number">90</span>)</span><br><span class="line">    forward(abs(endY - startY))</span><br><span class="line">    right(<span class="number">90</span>)</span><br><span class="line">    </span><br><span class="line">    end_fill()</span><br><span class="line">    pu()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rect</span>(<span class="params">startX, startY, endX, endY, r, g, b</span>):</span></span><br><span class="line">    colormode(<span class="number">255</span>)</span><br><span class="line">    pencolor(r, g, b)</span><br><span class="line">    begin_fill()</span><br><span class="line">    fillcolor((r, g, b))</span><br><span class="line">    goto(startX, startY)</span><br><span class="line">    pd()</span><br><span class="line">    forward(abs(endX - startX))</span><br><span class="line">    right(<span class="number">90</span>)</span><br><span class="line">    forward(abs(endY - startY))</span><br><span class="line">    right(<span class="number">90</span>)</span><br><span class="line">    forward(abs(endX - startX))</span><br><span class="line">    right(<span class="number">90</span>)</span><br><span class="line">    forward(abs(endY - startY))</span><br><span class="line">    right(<span class="number">90</span>)</span><br><span class="line">    </span><br><span class="line">    end_fill()</span><br><span class="line">    pu()</span><br><span class="line"></span><br><span class="line">json = json.loads(jsonStr)</span><br><span class="line">data = json[<span class="string">&quot;shapes&quot;</span>]</span><br><span class="line"></span><br><span class="line">speed(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">s0 = data[<span class="number">0</span>]</span><br><span class="line">pos = s0[<span class="string">&quot;data&quot;</span>]</span><br><span class="line">color = s0[<span class="string">&quot;color&quot;</span>]</span><br><span class="line">rect(pos[<span class="number">0</span>]  - <span class="number">250</span> , -pos[<span class="number">1</span>] + <span class="number">300</span> , pos[<span class="number">2</span>]  - <span class="number">250</span> , -pos[<span class="number">3</span>]  + <span class="number">300</span> , color[<span class="number">0</span>], color[<span class="number">1</span>], color[<span class="number">2</span>])</span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> data[<span class="number">1</span>:]:</span><br><span class="line">    pos = s[<span class="string">&quot;data&quot;</span>]</span><br><span class="line">    color = s[<span class="string">&quot;color&quot;</span>]</span><br><span class="line">    draw_circle(pos[<span class="number">0</span>] - <span class="number">250</span> , -pos[<span class="number">1</span>] + <span class="number">300</span> - pos[<span class="number">2</span>] , pos[<span class="number">2</span>] , color[<span class="number">0</span>], color[<span class="number">1</span>], color[<span class="number">2</span>])</span><br></pre></td></tr></table></figure>
<p><img src="/assets/me.jpg"></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> drawing=<span class="built_in">document</span>.getElementById(<span class="string">&quot;myCanvas&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (drawing.getContext)&#123;</span><br><span class="line">		<span class="keyword">var</span> ctx = drawing.getContext(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">heart</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> arrays = data[<span class="string">&quot;shapes&quot;</span>];</span><br><span class="line">		<span class="keyword">var</span> pos = arrays[index][<span class="string">&quot;data&quot;</span>];</span><br><span class="line">		<span class="keyword">var</span> color = arrays[index][<span class="string">&quot;color&quot;</span>];</span><br><span class="line">		<span class="keyword">var</span> type = arrays[index][<span class="string">&quot;type&quot;</span>];</span><br><span class="line">		<span class="keyword">switch</span>(type)&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>: </span><br><span class="line">		ctx.fillStyle = <span class="string">&quot;rgba(&quot;</span> + color[<span class="number">0</span>] + <span class="string">&quot;, &quot;</span>+ color[<span class="number">1</span>] + <span class="string">&quot;,  &quot;</span>+ color[<span class="number">2</span>] + <span class="string">&quot;, &quot;</span> + color[<span class="number">3</span>] / <span class="number">255</span> + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">		ctx.fillRect (pos[<span class="number">0</span>] , pos[<span class="number">1</span>] ,(pos[<span class="number">2</span>] - pos[<span class="number">0</span>]) , (pos[<span class="number">3</span>] - pos[<span class="number">1</span>]));</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">32</span>:</span><br><span class="line">          ctx.fillStyle = <span class="string">&quot;rgba(&quot;</span> + color[<span class="number">0</span>] + <span class="string">&quot;, &quot;</span>+ color[<span class="number">1</span>] + <span class="string">&quot;,  &quot;</span>+ color[<span class="number">2</span>] + <span class="string">&quot;, &quot;</span> + color[<span class="number">3</span>] / <span class="number">255</span> + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">		   ctx.beginPath();</span><br><span class="line">		   ctx.arc(pos[<span class="number">0</span>] ,pos[<span class="number">1</span>] ,pos[<span class="number">2</span>] ,<span class="number">0</span>,<span class="number">2</span>*<span class="built_in">Math</span>.PI);</span><br><span class="line">		   ctx.fill();</span><br><span class="line">		   <span class="keyword">break</span>;</span><br><span class="line">		   <span class="comment">//case 64:</span></span><br><span class="line">		   <span class="comment">//ctx.strokeStyle=&quot;rgba(&quot; + color[0] + &quot;, &quot;+ color[1] + &quot;,  &quot;+ color[2] + &quot;, &quot; + color[3] / 255 + &quot;)&quot;;</span></span><br><span class="line">		   <span class="comment">//ctx.beginPath();</span></span><br><span class="line">		   <span class="comment">//ctx.moveTo(n.get_x1(a),n.get_y1(a));</span></span><br><span class="line">		   <span class="comment">//ctx.lineTo(n.get_x2(a),n.get_y2(a));</span></span><br><span class="line">		   <span class="comment">//ctx.stroke();</span></span><br><span class="line">		   <span class="comment">//break; --&gt;</span></span><br><span class="line">		   &#125;</span><br><span class="line">            index++;</span><br><span class="line">            <span class="keyword">if</span> (index &gt; arrays.length)&#123;</span><br><span class="line">                <span class="built_in">clearInterval</span>(intervalId);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        intervalId = <span class="built_in">setInterval</span>(heart,<span class="number">25</span>);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/fogleman/primitive">https://github.com/fogleman/primitive</a></p>
<p><a href="https://www.samcodes.co.uk/project/geometrize-haxe-web/">https://www.samcodes.co.uk/project/geometrize-haxe-web/</a></p>
]]></content>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>802.1.x认证</title>
    <url>/2020/10/04/802-1-x/</url>
    <content><![CDATA[<p>公司的上网验证使用802.1.x，但是使用的是私有的客户端（只有mac和win），而且还有很多限制。<br>为了在linux平台上使用，开始了该项目。<br>由于不清楚密码如何加密的，但是确定加密与次数和时间没有关系，可以抓包获取认证的密钥。生成password.bin用于其他机器的认证。</p>
<p>在已安装客户端的机器上运行</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;flag&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/google/gopacket&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/google/gopacket/layers&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/google/gopacket/pcap&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> iface = flag.String(<span class="string">&quot;i&quot;</span>, <span class="string">&quot;\\Device\\NPF_&#123;540078E3-B5F2-4E7A-9D21-&#125;&quot;</span>, <span class="string">&quot;Interface to read packets from&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	flag.Parse()</span><br><span class="line">	filterStr := fmt.Sprintf(<span class="string">&quot;(ether proto 0x888e)&quot;</span>)</span><br><span class="line">	fmt.Println(*iface)</span><br><span class="line">	handle, err := pcap.OpenLive(*iface, <span class="number">65536</span>, <span class="literal">true</span>, pcap.BlockForever)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	err = handle.SetBPFFilter(filterStr)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> handle.Close()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> userName, passWord []<span class="keyword">byte</span></span><br><span class="line">	<span class="keyword">for</span> userName == <span class="literal">nil</span> || passWord == <span class="literal">nil</span> &#123;</span><br><span class="line">		data, _, err := handle.ReadPacketData()</span><br><span class="line">		<span class="keyword">if</span> err == pcap.NextErrorTimeoutExpired &#123;</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line">		packet := gopacket.NewPacket(data, layers.LayerTypeEthernet, gopacket.NoCopy)</span><br><span class="line">		<span class="keyword">if</span> eapLayer := packet.Layer(layers.LayerTypeEAP); eapLayer != <span class="literal">nil</span> &#123;</span><br><span class="line">			eap := eapLayer.(*layers.EAP)</span><br><span class="line">			<span class="keyword">switch</span> eap.Code &#123;</span><br><span class="line">			<span class="keyword">case</span> layers.EAPCodeResponse:</span><br><span class="line">				<span class="keyword">switch</span> eap.Type &#123;</span><br><span class="line">				<span class="keyword">case</span> layers.EAPTypeIdentity:</span><br><span class="line">					userName = eap.TypeData</span><br><span class="line">					fmt.Printf(<span class="string">&quot;%s&quot;</span>, <span class="keyword">string</span>(userName))</span><br><span class="line">				<span class="keyword">case</span> <span class="number">0x66</span>:</span><br><span class="line">					passWord = eap.TypeData</span><br><span class="line">					fmt.Println()</span><br><span class="line">					fmt.Printf(<span class="string">&quot;%x&quot;</span>, passWord)</span><br><span class="line">				<span class="keyword">default</span>:</span><br><span class="line">					fmt.Println(<span class="string">&quot;unknown eap type:&quot;</span>, eap.Type)</span><br><span class="line">				&#125;</span><br><span class="line">			<span class="keyword">case</span> layers.EAPCodeSuccess:</span><br><span class="line">			<span class="keyword">case</span> layers.EAPCodeFailure:</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			<span class="keyword">default</span>:</span><br><span class="line">				fmt.Println(<span class="string">&quot;unknown epa code:&quot;</span>, eap.Code)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	userName = <span class="built_in">append</span>(userName, <span class="number">0xff</span>)</span><br><span class="line">	userName = <span class="built_in">append</span>(userName, passWord...)</span><br><span class="line">	e := ioutil.WriteFile(<span class="string">&quot;password.bin&quot;</span>, userName, <span class="number">0644</span>)</span><br><span class="line">	<span class="keyword">if</span> e != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(e)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>在其他需要认证的机器上运行</p>
<figure class="highlight golang"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;flag&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/google/gopacket&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/google/gopacket/layers&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/google/gopacket/pcap&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	<span class="string">&quot;net&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	interfaceName <span class="keyword">string</span></span><br><span class="line">	localMac      <span class="keyword">string</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	flag.StringVar(&amp;interfaceName, <span class="string">&quot;interface&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;interface name&quot;</span>)</span><br><span class="line">	flag.StringVar(&amp;localMac, <span class="string">&quot;mac&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;mac address&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//https://github.com/google/gopacket/issues/456</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	flag.Parse()</span><br><span class="line">	authentication(interfaceName, localMac)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">authentication</span><span class="params">(interfaceName <span class="keyword">string</span>, localMac <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	filterStr := fmt.Sprintf(</span><br><span class="line">		<span class="string">&quot;(ether proto 0x888e) and (ether dst host %s)&quot;</span>, localMac)</span><br><span class="line">	handle, err := pcap.OpenLive(interfaceName, <span class="number">65536</span>, <span class="literal">true</span>, pcap.BlockForever)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	err = handle.SetBPFFilter(filterStr)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> handle.Close()</span><br><span class="line"></span><br><span class="line">	stop := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">	hwAddr, err := net.ParseMAC(localMac)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	data, err := ioutil.ReadFile(<span class="string">&quot;password.bin&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> index <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">for</span> i, v := <span class="keyword">range</span> data &#123;</span><br><span class="line">		<span class="keyword">if</span> v == <span class="keyword">byte</span>(<span class="number">0xff</span>) &#123;</span><br><span class="line">			index = i</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	username := <span class="keyword">string</span>(data[<span class="number">0</span>:index])</span><br><span class="line">	passwd := data[index+<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">	<span class="keyword">go</span> readEap(handle, hwAddr, stop, username, passwd)</span><br><span class="line">	<span class="keyword">defer</span> <span class="built_in">close</span>(stop)</span><br><span class="line"></span><br><span class="line">	time.Sleep(<span class="number">3000</span>)</span><br><span class="line">	<span class="keyword">go</span> broadcast(handle, hwAddr)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	wg.Add(<span class="number">1</span>)</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">readEap</span><span class="params">(handle *pcap.Handle, localMac net.HardwareAddr, stop <span class="keyword">chan</span> <span class="keyword">int</span>, username <span class="keyword">string</span>, password []<span class="keyword">byte</span>)</span></span> &#123;</span><br><span class="line">	src := gopacket.NewPacketSource(handle, layers.LayerTypeEthernet)</span><br><span class="line">	in := src.Packets()</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">var</span> packet gopacket.Packet</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> &lt;-stop:</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		<span class="keyword">case</span> packet = &lt;-in:</span><br><span class="line">			ethLayer := packet.Layer(layers.LayerTypeEthernet)</span><br><span class="line">			<span class="keyword">if</span> ethLayer == <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line">			eth := ethLayer.(*layers.Ethernet)</span><br><span class="line">			srcMac := eth.SrcMAC</span><br><span class="line"></span><br><span class="line">			eapLayer := packet.Layer(layers.LayerTypeEAP)</span><br><span class="line">			<span class="keyword">if</span> eapLayer == <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">			&#125;</span><br><span class="line">			eap := eapLayer.(*layers.EAP)</span><br><span class="line">			fmt.Println(<span class="string">&quot;eap data: &quot;</span>, eap)</span><br><span class="line"></span><br><span class="line">			<span class="keyword">switch</span> eap.Code &#123;</span><br><span class="line">			<span class="keyword">case</span> layers.EAPCodeRequest:</span><br><span class="line">				<span class="keyword">switch</span> eap.Type &#123;</span><br><span class="line">				<span class="keyword">case</span> layers.EAPTypeIdentity:</span><br><span class="line">					sendUserName(handle, localMac, srcMac, eap.Id, username)</span><br><span class="line">				<span class="keyword">case</span> <span class="number">0x66</span>:</span><br><span class="line">					sendPassword(handle, localMac, srcMac, eap.Id, password)</span><br><span class="line">				<span class="keyword">default</span>:</span><br><span class="line">					fmt.Println(<span class="string">&quot;unknown eap type:&quot;</span>, eap.Type)</span><br><span class="line">				&#125;</span><br><span class="line">			<span class="keyword">case</span> layers.EAPCodeSuccess:</span><br><span class="line">				stop &lt;- <span class="number">1</span></span><br><span class="line">				fmt.Println(<span class="string">&quot;epa success&quot;</span>)</span><br><span class="line">			<span class="keyword">case</span> layers.EAPCodeFailure:</span><br><span class="line">				fmt.Println(<span class="string">&quot;eap failure&quot;</span>)</span><br><span class="line">			<span class="keyword">default</span>:</span><br><span class="line">				fmt.Println(<span class="string">&quot;unknown epa code:&quot;</span>, eap.Code)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">broadcast</span><span class="params">(handle *pcap.Handle, localMac net.HardwareAddr)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	eth := layers.Ethernet&#123;</span><br><span class="line">		SrcMAC:       localMac,</span><br><span class="line">		DstMAC:       net.HardwareAddr&#123;<span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xff</span>&#125;,</span><br><span class="line">		EthernetType: <span class="number">0x888e</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	eaPol := layers.EAPOL&#123;</span><br><span class="line">		Version: <span class="number">0x01</span>,</span><br><span class="line">		Type:    layers.EAPOLTypeStart,</span><br><span class="line">		Length:  <span class="number">0x00</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	buf := gopacket.NewSerializeBuffer()</span><br><span class="line">	opts := gopacket.SerializeOptions&#123;</span><br><span class="line">		FixLengths:       <span class="literal">true</span>,</span><br><span class="line">		ComputeChecksums: <span class="literal">true</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	gopacket.SerializeLayers(buf, opts, &amp;eth, &amp;eaPol)</span><br><span class="line">	fmt.Println(<span class="string">&quot;broadcast &quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err := handle.WritePacketData(buf.Bytes()); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sendUserName</span><span class="params">(handle *pcap.Handle, srcMac net.HardwareAddr, destAddr net.HardwareAddr, id <span class="keyword">uint8</span>, username <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	eth := layers.Ethernet&#123;</span><br><span class="line">		SrcMAC:       srcMac,</span><br><span class="line">		DstMAC:       destAddr,</span><br><span class="line">		EthernetType: <span class="number">0x888e</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	eap := layers.EAP&#123;</span><br><span class="line">		Code:     layers.EAPCodeResponse,</span><br><span class="line">		Id:       id,</span><br><span class="line">		Length:   <span class="keyword">uint16</span>(<span class="built_in">len</span>([]<span class="keyword">byte</span>(username))),</span><br><span class="line">		Type:     layers.EAPTypeIdentity,</span><br><span class="line">		TypeData: []<span class="keyword">byte</span>(username),</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	buf := gopacket.NewSerializeBuffer()</span><br><span class="line">	opts := gopacket.SerializeOptions&#123;</span><br><span class="line">		FixLengths:       <span class="literal">true</span>,</span><br><span class="line">		ComputeChecksums: <span class="literal">true</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	gopacket.SerializeLayers(buf, opts, &amp;eth, &amp;eap)</span><br><span class="line">	fmt.Println(<span class="string">&quot;send username &quot;</span>, username)</span><br><span class="line">	<span class="keyword">if</span> err := handle.WritePacketData(buf.Bytes()); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sendPassword</span><span class="params">(handle *pcap.Handle, srcMac net.HardwareAddr, destAddr net.HardwareAddr, id <span class="keyword">uint8</span>, password []<span class="keyword">byte</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	eth := layers.Ethernet&#123;</span><br><span class="line">		SrcMAC:       srcMac,</span><br><span class="line">		DstMAC:       destAddr,</span><br><span class="line">		EthernetType: <span class="number">0x888e</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	eap := layers.EAP&#123;</span><br><span class="line">		Code:     layers.EAPCodeResponse,</span><br><span class="line">		Id:       id,</span><br><span class="line">		Length:   <span class="keyword">uint16</span>(<span class="built_in">len</span>(password)),</span><br><span class="line">		Type:     layers.EAPTypeIdentity,</span><br><span class="line">		TypeData: password,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	buf := gopacket.NewSerializeBuffer()</span><br><span class="line">	opts := gopacket.SerializeOptions&#123;</span><br><span class="line">		FixLengths:       <span class="literal">true</span>,</span><br><span class="line">		ComputeChecksums: <span class="literal">true</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	gopacket.SerializeLayers(buf, opts, &amp;eth, &amp;eap)</span><br><span class="line">	<span class="keyword">if</span> err := handle.WritePacketData(buf.Bytes()); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>控制树莓派</title>
    <url>/2020/10/04/rasp-ctl/</url>
    <content><![CDATA[<p>找了一圈没找到一个比较好的能用web控制订阅的工具，自己做一个。中途发现一些比较好的能满足我需求的<a href="https://github.com/twotreesus/V2ray.FunPi">项目</a>，又参考了一下<br>目前树莓派用于</p>
<ul>
<li>主路由</li>
<li>hostapd实现全局代理，并且实现了90DNS用于switch</li>
<li><a href="http://appdown.rrys.tv/rrshareweb_rpi.2.20.tar.gz">人人影视</a></li>
<li>文件共享用于小米盒子等播放</li>
</ul>
<p><img src="/assets/Screenshot_1.png"></p>
<p><a href="https://github.com/8DE4732A/rasp_control">https://github.com/8DE4732A/rasp_control</a></p>
]]></content>
      <categories>
        <category>raspberry</category>
      </categories>
      <tags>
        <tag>raspberry</tag>
      </tags>
  </entry>
  <entry>
    <title>tic80</title>
    <url>/2020/10/04/tic80/</url>
    <content><![CDATA[<p>tic80好玩的游戏收集</p>
<p><img src="https://raw.githubusercontent.com/tasogare66/nibiruman/master/capture/s02.gif"><br><a href="https://github.com/tasogare66/nibiruman">https://github.com/tasogare66/nibiruman</a></p>
]]></content>
      <categories>
        <category>game</category>
      </categories>
      <tags>
        <tag>game</tag>
      </tags>
  </entry>
  <entry>
    <title>洞窟物语</title>
    <url>/2020/10/04/doukutsu/</url>
    <content><![CDATA[<p>Remaking Cavestory in C++<br><a href="https://youtu.be/ETvApbD5xRo">https://youtu.be/ETvApbD5xRo</a></p>
<p>我想用go语言写一个。。。</p>
]]></content>
      <categories>
        <category>game</category>
      </categories>
      <tags>
        <tag>game</tag>
      </tags>
  </entry>
  <entry>
    <title>气象云图</title>
    <url>/2020/10/04/china-weather/</url>
    <content><![CDATA[<p>发现<a href="http://www.weather.com.cn/satellite/">中国天气网</a>的气象云图挺好看的，vps上搞了个定时任务，抓取图片，生成视频</p>
<p>定时抓取</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">req = urllib.request.Request(<span class="string">&quot;http://d1.weather.com.cn/satellite2015/JC_YT_DL_WXZXCSYT_4A.html?jsoncallback=readSatellite&amp;callback=jQuery18208455971171376718_&quot;</span> + str(round(time.time() * <span class="number">1000</span>)) + <span class="string">&quot;&amp;_=&quot;</span> + str(round(time.time() * <span class="number">1000</span>)))</span><br><span class="line">req.add_header(<span class="string">&#x27;Referer&#x27;</span>, <span class="string">&#x27;http://www.weather.com.cn/satellite/&#x27;</span>)</span><br><span class="line">req.add_header(<span class="string">&#x27;User-Agent&#x27;</span>, <span class="string">&#x27;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.109 Safari/537.36&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> urllib.request.urlopen(req) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read().decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    data = data[<span class="number">14</span>:<span class="number">-1</span>]</span><br><span class="line">    j = json.loads(data.replace(<span class="string">&#x27;\&#x27;&#x27;</span>,<span class="string">&#x27;\&quot;&#x27;</span>))</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> j[<span class="string">&#x27;radars&#x27;</span>]:</span><br><span class="line">        print(a[<span class="string">&#x27;ft&#x27;</span>])</span><br><span class="line">        urllib.request.urlretrieve(<span class="string">&quot;http://pi.weather.com.cn/i/product/pic/l/sevp_nsmc_&quot;</span> + a[<span class="string">&#x27;fn&#x27;</span>] + <span class="string">&quot;_lno_py_&quot;</span> + a[<span class="string">&#x27;ft&#x27;</span>] + <span class="string">&quot;.jpg&quot;</span>, <span class="string">&quot;D://weather/&quot;</span> + a[<span class="string">&#x27;ft&#x27;</span>] + <span class="string">&quot;.jpg&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>生成图片<br>先创建软链接用于ffmpeg</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line">p = Path(<span class="string">&#x27;D:\weather&#x27;</span>)</span><br><span class="line">file_names = [x.name <span class="keyword">for</span> x <span class="keyword">in</span> p.iterdir()]</span><br><span class="line">nums = sorted([x.split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> file_names])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(nums)):</span><br><span class="line">    Path(<span class="string">&#x27;D:\weather-ffmpeg\\&#x27;</span> + <span class="string">&#x27;&#123;0:06d&#125;&#x27;</span>.format(i) + <span class="string">&#x27;.jpg&#x27;</span>).symlink_to(<span class="string">&#x27;D:\weather\\&#x27;</span> + nums[i] + <span class="string">&#x27;.jpg&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/root/ffmpeg/ffmpeg -f image2 -i /root/weather-ffmpeg/%06d.jpg -vcodec libx264 -r 10 /var/http/weather.mp4</span><br></pre></td></tr></table></figure>


<p><a href="https://github.com/8DE4732A/china-weather">https://github.com/8DE4732A/china-weather</a></p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>最福利自动抢京东卡-android</title>
    <url>/2020/10/04/android-webview/</url>
    <content><![CDATA[<p>通过抓包获得h5页面地址，写了一个js可以自动下单。但是我希望晚上可以躺在床上抢，于是</p>
<p><img src="/assets/zuifuli.jpg"></p>
<p><a href="https://github.com/8DE4732A/zufuli_jd">https://github.com/8DE4732A/zufuli_jd</a></p>
]]></content>
  </entry>
  <entry>
    <title>nes模拟器</title>
    <url>/2020/10/06/nes-emulator/</url>
    <content><![CDATA[<p>youtube教程<br><a href="https://youtu.be/nViZg02IMQo">https://youtu.be/nViZg02IMQo</a></p>
<p>一个用go语言实现的<br><a href="https://github.com/rbaron/awesomenes">https://github.com/rbaron/awesomenes</a><br><a href="https://github.com/fogleman/nes">https://github.com/fogleman/nes</a></p>
<p>A JavaScript NES emulator.<br><a href="https://github.com/bfirsh/jsnes">https://github.com/bfirsh/jsnes</a></p>
<p>硬件参考信息来源<br><a href="http://nesdev.com/">http://nesdev.com/</a></p>
<p>待续。</p>
]]></content>
      <categories>
        <category>game</category>
      </categories>
      <tags>
        <tag>game</tag>
      </tags>
  </entry>
  <entry>
    <title>6502</title>
    <url>/2020/10/08/6502/</url>
    <content><![CDATA[<p>硬件参考资料<br><a href="http://www.6502.org/">http://www.6502.org/</a></p>
<p>一个java实现的6502模拟器<br><a href="https://github.com/sethm/symon">https://github.com/sethm/symon</a></p>
]]></content>
      <categories>
        <category>old-computer</category>
      </categories>
      <tags>
        <tag>old-computer</tag>
      </tags>
  </entry>
  <entry>
    <title>hackintosh</title>
    <url>/2020/11/03/hackintosh/</url>
    <content><![CDATA[<h4 id="system-image"><a href="#system-image" class="headerlink" title="system image"></a>system image</h4><p>10.15.7 (19H2)<br><a href="cloud.189.cn/t/EJBRvqqmmiAb">cloud.189.cn/t/EJBRvqqmmiAb</a><br>password: 6fhv</p>
<h4 id="efi"><a href="#efi" class="headerlink" title="efi"></a>efi</h4><p><a href="https://github.com/sineline/Thinkpad-x270-i5-6200U-HD520-Clover">Thinkpad x270</a></p>
<p><a href="https://github.com/lgs3137/PAVILION_Gaming_NB-macOS">HP 15-ak039TX (950M/GTX)</a></p>
]]></content>
      <categories>
        <category>mac</category>
      </categories>
      <tags>
        <tag>mac</tag>
      </tags>
  </entry>
  <entry>
    <title>一致性协议(raft)</title>
    <url>/2020/11/12/jraft/</url>
    <content><![CDATA[<h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><h2 id="线型一致性"><a href="#线型一致性" class="headerlink" title="线型一致性"></a>线型一致性</h2><h2 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h2><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><h3 id="jepsen"><a href="#jepsen" class="headerlink" title="jepsen"></a>jepsen</h3><p><a href="https://github.com/jepsen-io/jepsen">https://github.com/jepsen-io/jepsen</a></p>
<h3 id="sofa-jraft-jepsen"><a href="#sofa-jraft-jepsen" class="headerlink" title="sofa-jraft-jepsen"></a>sofa-jraft-jepsen</h3><p>代码现成的<a href="https://github.com/sofastack/sofa-jraft-jepsen">https://github.com/sofastack/sofa-jraft-jepsen</a> 实际操作一下</p>
<p>使用docer部署5个节点 和 一个控制端</p>
<p>Dockerfile</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">18.04</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> Description=<span class="string">&quot;This image is used to test jepsen for jraft&quot;</span></span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /root</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt update &amp;&amp; \</span></span><br><span class="line"><span class="bash">	apt install -y openssh-server &amp;&amp; \</span></span><br><span class="line"><span class="bash">	apt install -y openjdk-8-jre &amp;&amp; \</span></span><br><span class="line"><span class="bash">	apt install -y curl</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash">	curl -O https://download.clojure.org/install/linux-install-1.10.1.727.sh &amp;&amp;\</span></span><br><span class="line"><span class="bash">	chmod +x linux-install-1.10.1.727.sh &amp;&amp; \</span></span><br><span class="line"><span class="bash">	./linux-install-1.10.1.727.sh &amp;&amp; \</span></span><br><span class="line"><span class="bash">	useradd -d /home/admin -g root -s /bin/bash -m admin &amp;&amp; \</span></span><br><span class="line"><span class="bash">	mkdir /home/admin/.ssh </span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> --chown=admin:root authorized_keys /home/admin/.ssh/authorized_keys</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> --chown=root:root id_rsa /root/.ssh/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> --chown=root:root id_rsa.pub /root/.ssh/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> sofa-jraft-jepsen-master/ /root/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> /bin /usr/bin</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> service ssh start &amp;&amp; \</span></span><br><span class="line"><span class="bash">	<span class="built_in">export</span> PATH=/root/bin:<span class="variable">$PATH</span> &amp;&amp; \</span></span><br><span class="line"><span class="bash">	tail -f /var/<span class="built_in">log</span>/dpkg.log</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;bash&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>启动容器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">! /bin/sh</span></span><br><span class="line">docker run -d --network jepsen --hostname jraft.host1 --name jraft.host1 --rm jepsen:0.0.1</span><br><span class="line">docker run -d --network jepsen --hostname jraft.host2 --name jraft.host2 --rm jepsen:0.0.1</span><br><span class="line">docker run -d --network jepsen --hostname jraft.host3 --name jraft.host3 --rm jepsen:0.0.1</span><br><span class="line">docker run -d --network jepsen --hostname jraft.host4 --name jraft.host4 --rm jepsen:0.0.1</span><br><span class="line">docker run -d --network jepsen --hostname jraft.host5 --name jraft.host5 --rm jepsen:0.0.1</span><br><span class="line">docker run -d --network jepsen --hostname client --name client --rm jepsen:0.0.1</span><br></pre></td></tr></table></figure>

<ul>
<li>容器的名字要跟 nodes 和 project.cli 记录的一致</li>
<li>注意本地 authorized_keys id_rsa id_rsa.pub 的权限是0600</li>
</ul>
<p>问题</p>
<ol>
<li>apache-codec/commons-codec/1.2/commons-codec-1.2.jar 拉不下来<br>project.cli 增加 :repositories [[“alibaba” “<a href="http://maven.aliyun.com/nexus/content/groups/public&quot;]]">http://maven.aliyun.com/nexus/content/groups/public&quot;]]</a></li>
<li>error=’Not enough space’ (errno=12) 内存不够<br>project.cli 修改 :jvm-opts [“-Xms1g” “-Xmx1g” “-server” “-XX:+UseG1GC”]</li>
<li>java.lang.ClassNotFoundException: javax.xml.bind.DatatypeConverter 还是用openjdk-8吧</li>
<li>Unrecognized option: -client control 脚本里-client参数 去除</li>
<li>准备好http_proxy</li>
<li>jepsen不支持新的openssh生成的key <a href="https://stackoverflow.com/questions/53134212/invalid-privatekey-when-using-jsch">https://stackoverflow.com/questions/53134212/invalid-privatekey-when-using-jsch</a></li>
<li>没办法在aarch64架构上运行 由于rocksdb <a href="https://github.com/facebook/rocksdb/issues/5559">https://github.com/facebook/rocksdb/issues/5559</a></li>
</ol>
<ul>
<li>configuration-test: remove and add a random node.</li>
<li>bridge-test: weaving the network into happy little intersecting majority rings</li>
<li>pause-test: pausing random node with SIGSTOP/SIGCONT.</li>
<li>crash-test: killing random nodes and restarting them.</li>
<li>partition-test: Cuts the network into randomly chosen halves.</li>
<li>partition-majority-test: Cuts the network into randomly majority groups.</li>
</ul>
<h5 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h5><p>执行<code>bash run_test.sh --testfn configuration-test</code>后</p>
<p><img src="/assets/2020-11-15-1.png"><br><img src="/assets/2020-11-15-2.png"><br><img src="/assets/latency-quantiles.png"><br><img src="/assets/latency-raw.png"><br><img src="/assets/rate.png"></p>
<p>其他的执行比如 partition-test 需要iptables, docker能力有限，只能用虚拟机了.</p>
<h4 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h4><blockquote>
<p>参考:<br><a href="https://raft.github.io/raft.pdf">https://raft.github.io/raft.pdf</a><br><a href="http://thesecretlivesofdata.com/raft/">http://thesecretlivesofdata.com/raft/</a></p>
</blockquote>
]]></content>
      <categories>
        <category>算法</category>
      </categories>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>蚂蚁笔记</title>
    <url>/2020/11/07/leanote/</url>
    <content><![CDATA[<p>安装蚂蚁笔记</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">启动专属mongo</span></span><br><span class="line">docker run -d -p 37017:27017 -e MONGO_INITDB_ROOT_USERNAME=admin -e MONGO_INITDB_ROOT_PASSWORD=password -v /opt/leanote/mongo:/data/db --name leanote_mongo --restart always mongo:latest</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">修改app.conf</span></span><br><span class="line">vim /opt/leanote/app.conf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">创建leanote文件夹</span></span><br><span class="line">mkdir -p leanote-data/&#123;files,mongodb_backup,public/upload&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">启动leanote 应该使用birdge网络 用nginx 代理</span></span><br><span class="line">docker run -d -v /opt/leanote/app.conf:/leanote/conf/app.conf -v /opt/leanote/leanote-data:/leanote/data --name leanote --network host --restart always jim3ma/leanote</span><br></pre></td></tr></table></figure>

<p><a href="https://hub.docker.com/r/jim3ma/leanote">https://hub.docker.com/r/jim3ma/leanote</a></p>
<p> 不好用 发现已经凉凉了 </p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>opencv</title>
    <url>/2020/10/28/opencv/</url>
    <content><![CDATA[<h3 id="人脸检测"><a href="#人脸检测" class="headerlink" title="人脸检测"></a>人脸检测</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line">IMAGE_PATH = <span class="string">&quot;assets/&quot;</span></span><br><span class="line"></span><br><span class="line">p = Path(IMAGE_PATH)</span><br><span class="line">file_names = [x.name <span class="keyword">for</span> x <span class="keyword">in</span> p.iterdir()]</span><br><span class="line"><span class="keyword">for</span> file_name <span class="keyword">in</span> file_names:</span><br><span class="line">    img = cv2.imread(IMAGE_PATH + file_name)</span><br><span class="line">    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)</span><br><span class="line">    face_cascade = cv2.CascadeClassifier(</span><br><span class="line">        cv2.data.haarcascades + <span class="string">&#x27;haarcascade_frontalface_alt.xml&#x27;</span>)</span><br><span class="line">    faces = face_cascade.detectMultiScale(</span><br><span class="line">        gray, scaleFactor=<span class="number">1.2</span>, minNeighbors=<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">for</span> (x, y, w, h) <span class="keyword">in</span> faces:</span><br><span class="line">        img = cv2.rectangle(img, (x, y), (x + w, y + h), (<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), <span class="number">1</span>)</span><br><span class="line">        cv2.imwrite(IMAGE_PATH + file_name, img)</span><br></pre></td></tr></table></figure>
<h3 id="摄像头捕获"><a href="#摄像头捕获" class="headerlink" title="摄像头捕获"></a>摄像头捕获</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">cap = cv2.VideoCapture(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> cap.isOpened():</span><br><span class="line">    print(<span class="string">&quot;Cannot open camera&quot;</span>)</span><br><span class="line">    exit()</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    time.sleep(<span class="number">0.2</span>)</span><br><span class="line">    ret, frame = cap.read()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> ret:</span><br><span class="line">        print(<span class="string">&quot;Can&#x27;t receive frame (stream end?). Exiting ...&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)</span><br><span class="line">    face_cascade = cv2.CascadeClassifier(</span><br><span class="line">        cv2.data.haarcascades + <span class="string">&#x27;haarcascade_frontalface_alt.xml&#x27;</span>)</span><br><span class="line">    faces = face_cascade.detectMultiScale(</span><br><span class="line">        gray, scaleFactor=<span class="number">1.2</span>, minNeighbors=<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">for</span> (x, y, w, h) <span class="keyword">in</span> faces:</span><br><span class="line">        frame = cv2.rectangle(frame, (x, y), (x + w, y + h), (<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), <span class="number">1</span>)</span><br><span class="line">    cv2.imshow(<span class="string">&#x27;frame&#x27;</span>, frame)</span><br><span class="line">    <span class="keyword">if</span> cv2.waitKey(<span class="number">1</span>) == ord(<span class="string">&#x27;q&#x27;</span>):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">cap.release()</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>

<p><a href="http://woshicver.com/">http://woshicver.com/</a></p>
<p><a href="http://objectdetection.cn/">http://objectdetection.cn/</a></p>
]]></content>
      <categories>
        <category>img</category>
      </categories>
      <tags>
        <tag>img</tag>
      </tags>
  </entry>
  <entry>
    <title>人人影视</title>
    <url>/2020/10/17/rrys/</url>
    <content><![CDATA[<p>树莓派接入了两个isp(长城宽带，移动),由于长城宽带限制，使用人人影视时只想用移动的网。<br>使用的方案可以用veth，使用不同的网路命名空间加iptables, 还有直接借用docker</p>
<p>使用docker解决此问题</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">18.04</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> maintainer <span class="string">&quot;8de4732a&quot;</span></span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">3001</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">&quot;/opt/work/rrshareweb/data&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /rrys</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt update &amp;&amp; apt -y install wget &amp;&amp; wget http://appdown.rrys.tv/rrshareweb_rpi.2.20.tar.gz &amp;&amp; tar -zxf rrshareweb_rpi.2.20.tar.gz</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;/rrys/rrshareweb_rpi/rrshareweb&quot;</span>]</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker build . -t rrys:0.0.1</span><br></pre></td></tr></table></figure>
<p>alpine启动不了，只能用ubuntu了</p>
<p>启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -it -v /mnt/sd/rrys:/opt/work/rrshareweb/data -p 3001:3001 -name rrys rrys:0.0.1</span><br></pre></td></tr></table></figure>

<p>设置路由规则</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ip route add default via 192.168.1.1 dev wlan1 table 100</span><br><span class="line">ip route add 192.168.99.0&#x2F;24 via 192.168.1.1 dev eth0 table 100</span><br><span class="line">ip rule add from 172.17.0.0&#x2F;16 table 100</span><br><span class="line"></span><br><span class="line">或者利用MARK</span><br><span class="line">iptables -A PREROUTING -t mangle -s 172.17.0.0&#x2F;16 -j MARK --set-mark 3</span><br><span class="line">ip rule add fwmark 3 table 100</span><br></pre></td></tr></table></figure>


<p>参考</p>
<p><a href="http://linux-ip.net/html/tools-ip-routing.html">http://linux-ip.net/html/tools-ip-routing.html</a></p>
<p><a href="http://www.study-area.org/tips/adv-route/Adv-Routing-HOWTO-4.html">http://www.study-area.org/tips/adv-route/Adv-Routing-HOWTO-4.html</a></p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>tempermonkey</title>
    <url>/2020/10/30/tempermonkey/</url>
    <content><![CDATA[<p>恰到好处的油猴</p>
<p><a href="http://woshicver.com/">http://woshicver.com/</a> 去除关注</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         New Userscript</span></span><br><span class="line"><span class="comment">// @namespace    http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  try to take over the world!</span></span><br><span class="line"><span class="comment">// @author       You</span></span><br><span class="line"><span class="comment">// @match        http://woshicver.com/ThirdSection/*</span></span><br><span class="line"><span class="comment">// @grant        none</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">    &#x27;use strict&#x27;</span>;</span><br><span class="line">    $(<span class="string">&#x27;#read-more-mask&#x27;</span>).remove();</span><br><span class="line">    $(<span class="string">&#x27;#read-more-wrap&#x27;</span>).remove();</span><br><span class="line">    <span class="keyword">var</span> style = $(<span class="string">&#x27;#main&#x27;</span>).first().attr(<span class="string">&quot;style&quot;</span>);</span><br><span class="line">    $(<span class="string">&#x27;#main&#x27;</span>).attr(<span class="string">&quot;style&quot;</span>, style.replace(<span class="regexp">/hidden/</span>, <span class="string">&quot;false&quot;</span>));</span><br><span class="line">    $(<span class="string">&#x27;footer&#x27;</span>).remove();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
</search>
